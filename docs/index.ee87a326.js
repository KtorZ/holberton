const e={},t=new Date("2023-12-01T14:00:00Z"),n=new Date("2024-07-31T16:00:00Z"),r="control",o="fate",c={date:new Date("2022-10-28T01:00:15Z"),slot:259215};l(t);const s=l(n),a={matches:(t,n)=>`${e.API_URL}/matches/${t}?order=most_recent_first&created_before=${n}`,metadata:(t,n)=>`${e.API_URL}/metadata/${t}?transaction_id=${n}`};function l(e){let t=e-c.date;return Math.round(t/1e3)+c.slot}async function i(e){return Promise.all(e.map(async e=>{console.log("fetching...",e);let t=await fetch(a.matches(e.address,s)).then(e=>e.json()).then(e=>e[0]);return null!=t?function(e,t){let n=t.created_at.slot_no,c=t.transaction_index;return fetch(a.metadata(n,t.transaction_id)).then(e=>e.json()).then(t=>{let s=(t[0]||{}).schema||{},a=function e(t){if("object"==typeof t&&null!=t){if(t.hasOwnProperty("int")&&"number"==typeof t.int)return t.int;if(t.hasOwnProperty("string")&&"string"==typeof t.string)return t.string;if(t.hasOwnProperty("bytes")&&"string"==typeof t.bytes)return Uint8Array.from(t.bytes.match(/(.{2})/g).map(e=>Number.parseInt(e,16)));if(t.hasOwnProperty("list")&&Array.isArray(t.list))return t.list.map(e);if(t.hasOwnProperty("map")&&Array.isArray(t.map))return t.map.reduce((t,n)=>{let r=e(n.k),o=e(n.v);return("string"==typeof r||"int"==typeof r)&&(t[r]=o),t},{})}return null}(s[42]);if("object"==typeof a&&null!=a){let{strategy:t,percentage:s}=a;if((t===o||t===r)&&(void 0===s||Number.isSafeInteger(s)&&s>0&&s<=100))return{...e,choice:{strategy:t,slot:n,blockIndex:c,percentage:s}}}return e})}(e,t):Promise.resolve(e)})).catch(e=>(console.warn(e),[]))}function u({name:e,address:t,score:n,rank:r}){let o=null!==n,c=document.createElement("div");c.innerHTML=feather.icons[o?"check-circle":"x-circle"].toSvg();let s=c.childNodes[0];s.classList.add(o?"text-green-500":"text-red-500"),s.style="margin-left: auto";let a="";1===r?a="bg-yellow-300 text-white shadow-sm":2===r?a="bg-zinc-400 text-white shadow-sm":3===r&&(a="bg-amber-800 text-white shadow-sm");let l=document.createElement("article");return l.innerHTML=`<label class="px-6 py-3 rounded-full ${a} text-base">${o?r:"-"}</label>
    <div class="flex flex-col">
      <h3 class="text-base">${e} <span class="hidden text-xs md:inline-block lg:text-sm">(${t})</span></h3>
      <span class="${o?"":"hidden"} text-xs text-gray-500">${n} ${1===n?"pt":"pts"}</span>
    </div>`,l.className="flex items-center gap-x-8",l.appendChild(s),l}async function h(e,t){return i(t).then(t=>{t.length>0&&e.replaceChildren(...(function(e){let{fate:t,control:n,other:c}=e.reduce((e,t)=>{let n=(t.choice||{}).strategy;return n===o?e.fate.push(t):n===r?e.control.push(t):e.other.push(t),e},{fate:[],control:[],other:[]}),s=n.reduce((e,t)=>(null!=t.choice&&t.choice.strategy===r&&(e+=t.choice.percentage),e),0)>50,a=[],l=n.reduce((e,t)=>{let n=s?0:Math.floor(100*t.choice.percentage/100);return a.push({...t,score:n}),e+n},0),i=t.length,u=function(e,t=1){let n=0;for(let r=1;r<=e;r+=1)n+=Math.pow(r,t);return n}(i),h=100-l;return t.sort(f).forEach((e,t)=>{a.push({...e,score:Math.floor(h*Math.pow(t+1,1)/u)})}),c.forEach(e=>a.push({...e,score:null})),a.sort(function(e,t){return e.score===t.score?f(t,e):t.score-e.score}).map(({name:e,address:t,score:n},r)=>({name:e,address:t,score:n,rank:r+1}));function f(e,t){return null==e.choice?1:null==t.choice?-1:e.choice.slot===t.choice.slot?t.choice.blockIndex-e.choice.blockIndex:t.choice.slot-e.choice.slot}})(t).map(u))}).catch(console.warn)}async function f(e){fetch("players.json",{cache:"no-cache"}).then(e=>e.json()).then(e,t=>{console.warn("withPlayerNames",t),e([])})}window.app=async function r(o,c){!function(){for(;!e.API_URL;){let t=JSON.parse(localStorage.getItem("API_URL"));t&&t.ttl>Date.now()?e.API_URL=t.value:(e.API_URL=prompt("Please indicate Kupo's server API url configured for Preview network."),localStorage.setItem("API_URL",JSON.stringify({value:e.API_URL,ttl:Date.now()+36e5})))}}(),setInterval(()=>(function(e,r){if(r>=n)o("hours","--"),o("minutes","--"),o("seconds","--");else if(r<t){let[e,n,s]=c(t-r);o("hours",e),o("minutes",n),o("seconds",s)}else{let[e,t,s]=c(n-r);o("hours",e),o("minutes",t),o("seconds",s)}function o(t,n="--"){e.querySelector(`#${t}`).innerText="number"==typeof n?`00${n}`.slice(-2):n}function c(e){let t=Math.floor(e/36e5),n=Math.floor((e-36e5*t)/6e4);return[t,n,Math.floor((e-36e5*t-6e4*n)/1e3)]}})(c||document.querySelector("#countdown"),new Date),1e3),f(e=>{h(o,e).then(()=>setTimeout(()=>r(o),1e4))})};
//# sourceMappingURL=index.ee87a326.js.map
